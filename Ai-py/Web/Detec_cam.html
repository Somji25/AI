<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Hand Detection</title>
<style>
  video, canvas {
    width: 480px;
    height: 360px;
    border: 2px solid black;
  }
</style>
</head>
<body>

<h2>Hand Detection (WebSocket)</h2>

<video id="video" autoplay muted></video><br>
<canvas id="canvas"></canvas><br>

<button onclick="start()">Start</button>
<button onclick="stop()">Stop</button>

<script>
let video = document.getElementById("video");
let canvas = document.getElementById("canvas");
let ctx = canvas.getContext("2d");
let ws;
let stream;

async function start() {
  stream = await navigator.mediaDevices.getUserMedia({ video: true });
  video.srcObject = stream;

  ws = new WebSocket("wss://YOUR-RENDER-URL.onrender.com");

  ws.binaryType = "arraybuffer";

  ws.onmessage = (e) => {
    let img = new Image();
    img.src = URL.createObjectURL(new Blob([e.data]));
    img.onload = () => ctx.drawImage(img, 0, 0, canvas.width, canvas.height);
  };

  setInterval(sendFrame, 100);
}

function sendFrame() {
  if (!ws || ws.readyState !== 1) return;
  ctx.drawImage(video, 0, 0, canvas.width, canvas.height);
  canvas.toBlob(blob => ws.send(blob), "image/jpeg");
}

function stop() {
  if (ws) ws.close();
  if (stream) stream.getTracks().forEach(t => t.stop());
}
</script>

</body>
</html>
